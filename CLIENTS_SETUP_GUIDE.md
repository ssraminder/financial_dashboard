# Clients Page Setup Guide

## Overview

The Clients page allows you to manage your customer database with features including:

- âœ… CSV import from XTRF exports
- âœ… Manual client creation and editing
- âœ… Search and filtering
- âœ… Pagination
- âœ… Status management (Active, Potential, Inactive)
- âœ… Financial settings (GST, currency, payment terms)

**Note:** This is a **shared business database**. All authenticated users can view and manage all clients (not filtered by user).

---

## ğŸ”´ REQUIRED: Run Database Migration

Before using the Clients page, you **MUST** create the `clients` table in Supabase.

### Steps:

1. **Open Supabase Dashboard**
   - Go to [https://supabase.com/dashboard](https://supabase.com/dashboard)
   - Select your project

2. **Open SQL Editor**
   - Click "SQL Editor" in the left sidebar
   - Click "New Query"

3. **Run the Migration**
   - Open the file `supabase-clients-schema.sql` in this project
   - Copy the **entire contents** of that file
   - Paste it into the Supabase SQL Editor
   - Click **"Run"** (or press `Ctrl+Enter`)

4. **Verify Success**
   - You should see: `Success. No rows returned`
   - Run this verification query:
   ```sql
   SELECT table_name
   FROM information_schema.tables
   WHERE table_schema = 'public'
   AND table_name = 'clients';
   ```

   - You should see `clients` in the results

**âš ï¸ If you already created the clients table WITH user_id:**
- Run `supabase-clients-remove-user-id.sql` to remove the user_id column and update RLS policies
- This migration is safe to run and won't delete your existing client data

---

## Features Guide

### 1. Viewing Clients

- Navigate to **Clients** in the sidebar
- Clients are displayed in a table with:
  - Name
  - XTRF ID
  - Email (truncated if long)
  - Country
  - Status badge with emoji indicators

### 2. Importing from XTRF

**Supported Format:**

- XTRF client export CSV files
- Expected columns: `ID`, `Name`, `Status`, `Country`, `Phone`, `E-mail`

**How to Import:**

1. Click **"Import CSV"** button
2. Drag & drop or browse for your XTRF CSV file
3. Choose import options:
   - â˜‘ **Update existing clients** - Updates clients that match by XTRF ID
   - â˜‘ **Add new clients** - Imports clients not in your database
   - â˜ **Mark missing as inactive** - Sets clients not in CSV as inactive
4. Click **"Import Clients"**
5. Watch the progress indicator
6. Review the import summary

**CSV Format Example:**

```csv
Generated by XTRF on 2024-12-28

ID;Name;Status;Country;Phone;E-mail
C001372;Amandine BOIS;Active;;+1234567890;meca.et.wheels@gmail.com
C001371;Tetiana Puhach;Active;;+0987654321;tanyajano@gmail.com
C001370;Hassan Cheaib;Active;;+1122334455;hassan_cheaib@hotmail.com
```

### 3. Manual Client Management

**Add New Client:**

1. Click **"+ Add Client"** button
2. Fill in required fields (Name is mandatory)
3. Optional: Enter XTRF ID (auto-generates LOCAL001, LOCAL002... if blank)
4. Set financial settings:
   - GST Rate (default 5%)
   - GST Exempt checkbox
   - Preferred Currency
   - Payment Terms
   - Client Type
5. Click **"Add Client"**

**Edit Existing Client:**

1. Click on any client row in the table
2. Or click the â‹® menu and select **"Edit"**
3. Update any fields
4. Click **"Save Changes"**

**Delete Client:**

1. Click the â‹® menu on a client row
2. Select **"Delete"**
3. Confirm the deletion

### 4. Search and Filters

**Search:**

- Type in the search box to filter by:
  - Client name
  - Email address
  - XTRF ID
- Search is debounced (waits 300ms after you stop typing)

**Status Filter:**

- Use the dropdown to filter by:
  - All Statuses
  - Active ğŸŸ¢
  - Potential ğŸŸ¡
  - Inactive ğŸ”´

### 5. Pagination

- Page size: 20 clients per page
- Use **Previous** and **Next** buttons to navigate
- Current page and total pages shown in the center

---

## Database Schema

### Table: `clients`

| Column               | Type      | Description                                      |
| -------------------- | --------- | ------------------------------------------------ |
| `id`                 | UUID      | Primary key (auto-generated)                     |
| `xtrf_id`            | TEXT      | Unique XTRF client ID (or LOCAL001, LOCAL002...) |
| `name`               | TEXT      | Client name (required)                           |
| `email`              | TEXT      | Email address                                    |
| `phone`              | TEXT      | Phone number                                     |
| `country`            | TEXT      | Country                                          |
| `province`           | TEXT      | Province (for Canadian clients)                  |
| `status`             | TEXT      | Active, Potential, or Inactive                   |
| `is_active`          | BOOLEAN   | Active status flag                               |
| `gst_rate`           | DECIMAL   | GST percentage (default 5.00)                    |
| `gst_exempt`         | BOOLEAN   | GST exemption flag                               |
| `preferred_currency` | TEXT      | CAD, USD, EUR, GBP                               |
| `payment_terms`      | TEXT      | Due on Receipt, Net 15, Net 30, Net 60           |
| `client_type`        | TEXT      | Individual, Business, Organization               |
| `is_recurring`       | BOOLEAN   | Recurring client flag                            |
| `notes`              | TEXT      | Free-form notes                                  |
| `last_synced_at`     | TIMESTAMP | Last XTRF sync timestamp                         |
| `created_at`         | TIMESTAMP | Record creation timestamp                        |
| `updated_at`         | TIMESTAMP | Last update timestamp (auto-updated)             |

---

## Row Level Security (RLS)

The `clients` table has RLS enabled with policies that:

- âœ… Allow all authenticated users to view all clients (shared business database)
- âœ… Allow all authenticated users to insert clients
- âœ… Allow all authenticated users to update clients
- âœ… Allow all authenticated users to delete clients

**Note:** This is a shared database. All team members can access and manage all clients.

---

## Troubleshooting

### "Failed to fetch" Error

**Cause:** The `clients` table doesn't exist in your Supabase database.

**Fix:** Run the migration in `supabase-clients-schema.sql` (see steps above).

---

### CSV Import Fails

**Common Issues:**

1. **Wrong CSV Format**
   - Ensure the CSV is from XTRF
   - Check that headers include: `ID`, `Name`, `Status`
2. **Special Characters**
   - CSV should use semicolon (`;`) as delimiter
   - Ensure UTF-8 encoding

3. **Duplicate XTRF IDs**
   - If updating existing clients, ensure XTRF IDs are unique
   - The upsert will update records with matching `xtrf_id`

---

### Empty Client List

**Possible Causes:**

1. **No clients imported yet**
   - Import from XTRF or add manually
2. **Wrong user context**
   - Check that you're logged in
   - Clients are filtered by `user_id` via RLS

3. **Status filter active**
   - Reset status filter to "All Statuses"

---

## Sample Data (Optional)

To test the feature, you can insert sample clients by uncommenting the section at the bottom of `supabase-clients-schema.sql`:

```sql
INSERT INTO clients (xtrf_id, name, email, country, status, gst_rate, preferred_currency)
VALUES
  ('C001372', 'Amandine BOIS', 'meca.et.wheels@gmail.com', NULL, 'Active', 5.00, 'CAD'),
  ('C001371', 'Tetiana Puhach', 'tanyajano@gmail.com', NULL, 'Active', 5.00, 'CAD'),
  ('C001370', 'Hassan Cheaib', 'hassan_cheaib@hotmail.com', NULL, 'Active', 5.00, 'CAD');
```

---

## Next Steps

After setting up the Clients page:

1. âœ… Import your XTRF client database
2. âœ… Review and update client financial settings
3. âœ… Set up recurring clients
4. Consider:
   - Linking clients to transactions
   - Generating client-specific reports
   - Setting up automated reminders for payment terms

---

## File Summary

| File                            | Purpose                                  |
| ------------------------------- | ---------------------------------------- |
| `client/pages/Clients.tsx`      | Main Clients page component              |
| `client/types/index.ts`         | Client TypeScript interface              |
| `supabase-clients-schema.sql`   | Database migration script                |
| `client/components/Sidebar.tsx` | Updated navigation (includes Clients)    |
| `client/App.tsx`                | Updated router (includes /clients route) |

---

## Support

If you encounter any issues:

1. Check the browser console for errors
2. Verify the database migration ran successfully
3. Ensure you're logged in with a valid user account
4. Check Supabase Dashboard > Authentication > Users to confirm your user exists

---

**ğŸ‰ You're all set! Navigate to `/clients` to start managing your client database.**
